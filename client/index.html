<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css" />

    <script src="./API.js"></script>

    <script defer src="./timeline.js"></script>
    <script defer src="./postForm.js"></script>
    <script defer src="./post.js"></script>
    <script defer src="./User.js"></script>
    <script defer src="./index.js"></script>

    <title>FriendFace</title>
</head>

<body>

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-light bg-blue">
            <a class="navbar-brand" href="#">FriendFace</a>
        </nav>

        <div class="row">
            <div class="col-sm-3" id="sidebar">

                <div class="card" style="width: 255px; display: none;" id="signin">
                    <div class="card-body">
                        <h4 class="card-title text-center" id="name">Sign In</h4>
                        <form id="signinform">
                            <div class="row form-group">
                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="email"  class="form-control" name="email" placeholder="Email" required>
                                    <span id="status"></span>
                                </div>
                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="password"  class="form-control" name="password" placeholder="Password">
                                </div>
                                <div class="col-sm-8 offset-sm-2">
                                    <input type="submit" name="submit" value="Sign In" class="btn  btn-outline-dark  btn-block">
                                </div>
                            </div>
                        </form>
                        <div class="text-center">
                            <a href="#" id="createAccount">Create Account</a>
                        </div>
                    
                    </div>
                </div>

                <div class="card" style="width: 255px; display:none;"  id="signup">
                    <div class="card-body">
                        <h4 class="card-title text-center" id="name">Create Account</h4>
                        <form id="signupform">
                            <div class="row form-group">

                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="email"  class="form-control" name="email" placeholder="Email" required >
                                    <span id="status"></span>
                                </div>

                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="text"  class="form-control" name="f_name" placeholder="First name" required >
                                </div>

                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="text"  class="form-control" name="l_name" placeholder="Last name"required >
                                </div>

                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="text"  class="form-control" name="location" placeholder="Location" required >
                                </div>

                                <div class="col-sm-12" style="margin-bottom: 1em;">
                                    <input type="text"  class="form-control" name="tagline" placeholder="Tagline">
                                </div>

                                <div class="col-sm-8 offset-sm-2">
                                    <input type="submit" name="submit" value="Sign In" class="btn  btn-outline-dark  btn-block">
                                </div>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
                

            <div class="col-sm-9" id="main-content">
                <div id="postform">
                    <form id="post-form">
                        <div class="row form-group">
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="post-content" name="comment" placeholder="New Post">
                            </div>

                            <div class="col-sm-2">
                                <button type="submit" class="btn  btn-outline-dark  btn-block">Post</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class=" list-group" style="width: 100%;" id="timeline"></div>
            </div>

        </div>
    </div>

    <script>
        const signinBox = document.getElementById('signin');
        const signInForm = document.getElementById('signinform');

        const profile = document.getElementById('profile');
        const createBtn = document.getElementById('createAccount');

        const signupBox = document.getElementById('signup');
        const signupForm = document.getElementById('signupform');
        
        const login = (email) => {
            API.loginUser(email).then(
                newUser => {
                    if (newUser.error) {
                        const error = document.getElementById('status')
                        error.innerText = "Email not found."
                        error.style.color = "Red";
                    } else {
                       signInForm.style.display = "none"
                        new User(newUser)
                    }
                });
        }
        
        if (document.cookie) {
            signinBox.remove();
            userEmail = document.cookie.split('=')[1].split(';')[0];

            login(userEmail);
        } else {
            signinBox.style.display = "block";
        }

        createBtn.addEventListener('click', e => {
            e.preventDefault();
            signinBox.style.display = "none";
            signupBox.style.display = "block";
        })

        signupForm.addEventListener('submit', e => {
            e.preventDefault();
            const f_name = signupForm.f_name.value;
            const l_name = signupForm.l_name.value;
            const email = signupForm.email.value;
            const location = signupForm.location.value;
            const tagline = signupForm.tagline.value;

            newUser = {f_name, l_name, email, location, tagline};

            API.createUser(newUser)
                .then(user => login(user.email));

        })

        signInForm.addEventListener('submit', e => {
            e.preventDefault();
            const emailAdd = signInForm.email.value
            login(emailAdd);
            
        });
        
    </script>

</body>

</html>